<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Exokit Launcher</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="App.css">
  <link href="https://fonts.googleapis.com/css?family=K2D" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">

  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

  <!-- <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script> -->

</head>

<body>

<script src="renderer.js"></script>
<div id="app"></div>

<script type="text/babel">
  const {ipcRenderer} = require('electron');

  class App extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        progress: 0,
        needsUpdate: false,
        userVersion: '',
        upstreamVersion: '',
        url: '',
        flags: ''
      };
      this.launchTerminal = this.launchTerminal.bind(this);
      this.launchExoHome = this.launchExoHome.bind(this);
      this.checkVersion = this.checkVersion.bind(this);
      this.onSettingsSave = this.onSettingsSave.bind(this);
    }

    componentDidMount(){
      document.getElementById('defaultUpdate').hidden = false;
      document.getElementById('needsUpdate').hidden = true;
      document.getElementById('downloadingUpdate').hidden = true;
      this.checkVersion();
    }

    onURLChange = (e) => {
      this.setState({ url: e.target.value });
      console.log(this.state.url);
    };

    onSettingsSave = (e) => {
      e.preventDefault();
      let flags = '';
      if(document.getElementById("-u").checked){
        flags += 'u'
      }
      if(document.getElementById("-p").checked){
        flags += 'p'
      }
      if(document.getElementById("-x").checked){
        flags += 'x'
      }
      if(document.getElementById("-t").checked){
        flags += 't'
      }
      if(document.getElementById("-m").checked){
        flags += 'm'
      }
      if(document.getElementById("-w").checked){
        flags += 'w'
      }
      this.setState({ flags: flags });
    };

    openSocial(url){
      ipcRenderer.on('asynchronous-reply', (event, arg) => {
        console.log(arg);
        ipcRenderer.removeAllListeners('asynchronous-reply');
      });
      ipcRenderer.send('asynchronous-message', 'social', url) // Launch Terminal from Node
    }

    launchTerminal(){
      ipcRenderer.on('asynchronous-reply', (event, arg) => {
        console.log(arg);
        ipcRenderer.removeAllListeners('asynchronous-reply');
      });
      ipcRenderer.send('asynchronous-message', 'terminal', this.state.url, this.state.flags) // Launch Terminal from Node
    }

    launchExoHome(){
      ipcRenderer.on('asynchronous-reply', (event, arg) => {
        console.log(arg);
        ipcRenderer.removeAllListeners('asynchronous-reply');
      });
      ipcRenderer.send('asynchronous-message', 'exohome') // Launch ExoHome from Node
    }

    updateExokit(){
      let progress = 0;
      ipcRenderer.on('asynchronous-reply', (event, arg) => {
        progress = (arg * 100).toFixed(0);
        this.setState({ progress: progress });
        if(this.state.progress === 100){
          ipcRenderer.removeAllListeners('asynchronous-reply');
        }
      });
      ipcRenderer.send('asynchronous-message', 'update');
      document.getElementById('defaultUpdate').hidden = true;
      document.getElementById('needsUpdate').hidden = true;
      document.getElementById('downloadingUpdate').hidden = false;
    }

    checkVersion(){
      let versions = [];
      ipcRenderer.on('asynchronous-reply', (event, arg) => {
        versions.push(arg);
        if(versions.length === 2){
          if(versions[0] !== versions[1]){
            console.log('Your version is out of date');
            this.setState({ needsUpdate: true });
            this.setState({ userVersion: versions[0] });
            this.setState({ upstreamVersion: versions[1] });
            document.getElementById('defaultUpdate').hidden = true;
            document.getElementById('needsUpdate').hidden = false;
            ipcRenderer.removeAllListeners('asynchronous-reply');
          }
          else if(versions[0] === versions[1]){
            console.log('Your version is up-to date');
            document.getElementById('defaultUpdate').hidden = false;
            document.getElementById('needsUpdate').hidden = true;
            this.setState({ needsUpdate: false });
            this.setState({ userVersion: versions[0] });
            this.setState({ upstreamVersion: versions[1] });
            ipcRenderer.removeAllListeners('asynchronous-reply');
          }
        }
      });
      ipcRenderer.send('asynchronous-message', 'version') // Launch ExoHome from Node
    }

    render() {

      return (
        <div>
          <div className="row p-2">
            <div className="col-4">
              <a onClick={() => this.openSocial('https://twitter.com/webmixedreality')}>
                <i className="fab fa-twitter m-2"/>
              </a>
              <a onClick={() => this.openSocial('https://medium.com/@avaerkazmer')}>
                <i className="fab fa-medium-m m-2"/>
              </a>
              <a onClick={() => this.openSocial('https://github.com/webmixedreality/exokit')}>
                <i className="fab fa-github m-2"/>
              </a>
              <a onClick={() => this.openSocial('https://discordapp.com/invite/Apk6cZN')}>
                <i className="fab fa-discord m-2"/>
              </a>
              <a onClick={() => this.openSocial('https://exokit.slack.com/join/shared_invite/enQtNDI3NjcxNzYwMDIxLWU2NmFmOTEzMzk4NWNiYjRhMjVkYzcyNjg5YjUyMzZkYWM1ZGI4M2IwYWZiMjNlMTJjMDlkM2U3Y2JiNTc2M2Q')}>
                <i className="fab fa-slack m-2"/>
              </a>
            </div>
            <div className="col-4 text-center mx-auto">
              <img src="https://docs.webmr.io/img/ExokitLogo.png" height="100" width="100" className="mx-auto"/>
            </div>
            <div className="col-4">

            </div>
          </div>

          <div className="row">
            <div className="col-1">
            </div>
            <div className="col-5">
              <h3 className="text-center mx-auto">Settings</h3>
              <form>
                <div className="form-group">
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-u"/>
                      <label className="custom-control-label" htmlFor="-u"><code>-u</code> | Uncap FPS</label>
                  </div>
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-p"/>
                      <label className="custom-control-label" htmlFor="-p"><code>-p</code> | Performance Log to
                        Console</label>
                  </div>
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-x"/>
                      <label className="custom-control-label" htmlFor="-x"><code>-x</code> | WebXR</label>
                  </div>
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-t"/>
                    <label className="custom-control-label" htmlFor="-t"><code>-t</code> | Reality Tab</label>
                  </div>
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-m"/>
                    <label className="custom-control-label" htmlFor="-m"><code>-m</code> | Minimal Frame	</label>
                  </div>
                  <div className="custom-control custom-checkbox">
                    <input type="checkbox" className="custom-control-input" id="-w"/>
                    <label className="custom-control-label" htmlFor="-w"><code>-w</code> | WebGL	</label>
                  </div>
                </div>
                <div className="form-inline d-inline">
                  <input onChange={this.onURLChange} type="text" className="form-control" id="formGroupExampleInput" placeholder="Run with custom URL"/>
                </div>
                <button onClick={(e) => this.onSettingsSave(e)} className="btn btn-sm btnSecondary m-2 p-2">Save</button>
              </form>
            </div>

            <div className="col-5">
              <h3 className="text-center">News</h3>
              <div id="carouselExampleIndicators" className="carousel slide" data-ride="carousel">
                <ol className="carousel-indicators">
                  <li data-target="#carouselExampleIndicators" data-slide-to="0" className="active"/>
                  <li data-target="#carouselExampleIndicators" data-slide-to="1"/>
                  <li data-target="#carouselExampleIndicators" data-slide-to="2"/>
                </ol>
                <div className="carousel-inner">
                  <div className="carousel-item active">
                    <img className="d-block text-center mx-auto"
                         src="https://i.ytimg.com/vi/1NpBvrDMYIo/maxresdefault.jpg" alt="First slide"/>
                    <div className="carousel-caption d-none d-md-block">
                      <h5>Follow us on Twitter</h5>
                      <p>Stay up to speed with our latest updates.</p>
                    </div>
                  </div>
                  <div className="carousel-item">
                    <img className="d-block text-center mx-auto"
                         src="https://cdn-images-1.medium.com/max/1200/1*wzEf4qVNT7mUeMIeQWTJbg.jpeg" alt="Second slide"/>
                    <div className="carousel-caption d-none d-md-block">
                      <h5>Know how to code?</h5>
                      <p>Check out our Github repo!</p>
                    </div>
                  </div>
                  <div className="carousel-item">
                    <img className="d-block text-center mx-auto"
                         src="https://cdn-images-1.medium.com/max/2000/1*XdsMp25hIwODAA2O2Ef1TQ.png" alt="Third slide"/>
                    <div className="carousel-caption d-none d-md-block">
                      <h5>Read our latest Blog</h5>
                      <p>Medium posts written by our dev team.</p>
                    </div>
                  </div>
                </div>
                <a className="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                  <span className="carousel-control-prev-icon" aria-hidden="true"/>
                  <span className="sr-only">Previous</span>
                </a>
                <a className="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                  <span className="carousel-control-next-icon" aria-hidden="true"/>
                  <span className="sr-only">Next</span>
                </a>
              </div>
            </div>

            <div className="col-1">
            </div>
          </div>

            <div className="row pt-3 pl-4 pb-4 fixed-bottom">

              <div className="col-8" id='defaultUpdate'>
                <h5 className="">Updates - <span style={{"color": "#00b490"}}><small>You are up-to date!</small></span></h5>
                <p>Your Version: <span style={{"color": "#00b490"}}>{this.state.userVersion}</span></p>
                <p className="pt-0">Version Available: <span style={{"color": "#00b490"}}>{this.state.upstreamVersion}</span></p>
              </div>

              <div className="col-8 mb-2" id='needsUpdate'>
                <h5 className="">Updates - <span style={{"color": "orange"}}><small>Update Available</small></span></h5>
                <p>Your Version: <span style={{"color": "orange"}}>{this.state.userVersion}</span></p>
                <p className="d-inline">Version Available: <span style={{"color": "#00b490"}}>{this.state.upstreamVersion}</span></p>
                <button type="submit" className="btn btn-sm ml-2" onClick={() => this.updateExokit()}>Update</button>
              </div>

              <div className="col-8" id='downloadingUpdate'>
                <h5 className="">Updates - <span style={{"color": "#00b490"}}><small>Downloading version: {this.state.upstreamVersion}</small></span></h5>
                <div className="progress">
                  <div className="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style={{"width": this.state.progress + "%"}}
                       aria-valuenow={this.state.progress} aria-valuemin="0" aria-valuemax="100"/>
                </div>
                <p className="text-center">{this.state.progress}%</p>
              </div>

              <div className="col-4">
                <h5>Launch</h5>
                <button className="btn m-2" onClick={() => this.launchTerminal()}>Terminal</button>
                <button className="btn m-2" onClick={() => this.launchExoHome()}>Exo-Home</button>
              </div>
            </div>

        </div>
      );
    }
  }

  ReactDOM.render(
    <div>
      <App/>
    </div>,
    document.getElementById('app')
  )

</script>

</body>
</html>
